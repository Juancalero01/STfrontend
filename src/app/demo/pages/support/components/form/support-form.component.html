<form class="w-full flex flex-column gap-3 py-2" [formGroup]="supportForm">
  <div class="w-full flex flex-column" *ngIf="showSearch">
    <label>BUSCADOR DEL PRODUCTO</label>
    <div class="w-full flex gap-2">
      <input
        type="text"
        pInputText
        class="w-full"
        formControlName="search"
        pKeyFilter="int"
        maxlength="10"
        minlength="3"
        placeholder="Ingresar número de serie..."
        [ngClass]="{
          'ng-invalid ng-dirty': validateForm('search')
        }"
      />
      <p-button
        icon="pi pi-search"
        styleClass=" p-button-secondary"
        (onClick)="searchProduct()"
        [disabled]="supportForm.get('search')?.invalid"
      />
    </div>
    <small *ngIf="validateForm('search')" class="p-error">
      Campo requerido*
    </small>
  </div>
  <div class="w-full flex gap-2">
    <div class="w-full">
      <label>FECHA DE REGISTRO</label>
      <p-calendar
        formControlName="dateEntry"
        dateFormat="dd-mm-yy"
        styleClass="w-full"
        appendTo="body"
        [showButtonBar]="true"
        [minDate]="minDate"
        [maxDate]="maxDate"
        [showClear]="true"
        [ngClass]="{ 'ng-invalid ng-dirty': validateForm('dateEntry') }"
        placeholder="Seleccionar fecha de registro..."
      />
      <small *ngIf="validateForm('dateEntry')" class="p-error">
        Campo requerido*
      </small>
    </div>
    <div class="w-full">
      <label>TIPO DE PRIORIDAD</label>
      <p-dropdown
        [options]="priorities"
        optionLabel="name"
        optionValue="id"
        placeholder="Seleccionar prioridad..."
        styleClass="w-full"
        formControlName="priority"
        [showClear]="true"
        [ngClass]="{ 'ng-invalid ng-dirty': validateForm('priority') }"
      />
      <small *ngIf="validateForm('priority')" class="p-error">
        Campo requerido*
      </small>
    </div>
  </div>

  <div class="w-full flex gap-2">
    <div class="w-full">
      <label>NÚMERO DE RECLAMO</label>
      <input type="text" pInputText class="w-full" formControlName="reclaim" />
    </div>
    <div class="w-full">
      <label>ESTADO DEL SERVICIO</label>
      <p-dropdown
        [options]="states"
        optionLabel="name"
        optionValue="id"
        styleClass="w-full uppercase"
        formControlName="state"
        dropdownIcon="none"
      />
    </div>
  </div>

  <div class="w-full flex gap-2">
    <div class="w-full">
      <label>RAZÓN SOCIAL</label>
      <input
        type="text"
        pInputText
        class="w-full uppercase"
        formControlName="client"
      />
    </div>
    <div class="w-full">
      <label>NÚMERO DE SERIE DEL PRODUCTO</label>
      <input
        type="text"
        pInputText
        class="w-full"
        formControlName="productSerial"
      />
    </div>
    <div class="w-full">
      <label>NOMBRE DEL PRODUCTO</label>
      <input
        type="text"
        pInputText
        class="w-full uppercase"
        formControlName="productType"
      />
    </div>
    <div class="w-full">
      <label>FECHA DE DESPACHO DEL PRODUCTO</label>
      <p-calendar
        formControlName="productDateEntry"
        dateFormat="dd-mm-yy"
        styleClass="w-full"
        [ngClass]="{ 'ng-invalid ng-dirty': validateForm('dateEntry') }"
        placeholder="Seleccionar fecha de registro..."
      />
    </div>
  </div>

  <div class="w-full flex gap-2">
    <div class="w-full">
      <label>GARANTÍA DE PRODUCCIÓN</label>
      <input
        type="text"
        pInputText
        class="w-full"
        formControlName="warrantyProduction"
        [class]="
          supportForm.get('warrantyProduction')?.value ===
          'GARANTÍA DE PRODUCCIÓN VENCIDA'
            ? 'bg-red-100 text-red-600'
            : supportForm.get('warrantyProduction')?.value === 'N/A'
            ? 'bg-gray-100 text-gray-600'
            : supportForm.get('warrantyProduction')?.value
            ? 'bg-green-100 text-green-600'
            : 'bg-gray-100 text-gray-600'
        "
      />
    </div>
    <div class="w-full">
      <label>GARANTÍA DE SERVICIO TÉCNICO</label>
      <input
        type="text"
        pInputText
        class="w-full"
        formControlName="warrantyService"
        [class]="
          supportForm.get('warrantyService')?.value ===
          'GARANTÍA DE SERVICIO TÉCNICO VENCIDA'
            ? 'bg-red-100 text-red-600'
            : supportForm.get('warrantyService')?.value === 'N/A'
            ? 'bg-gray-100 text-gray-600'
            : supportForm.get('warrantyService')?.value
            ? 'bg-green-100 text-green-600'
            : 'bg-gray-100 text-gray-600'
        "
      />
    </div>
    <div class="w-full">
      <label>GARANTIA</label>
      <p-dropdown
        [options]="booleanDropdown"
        optionLabel="label"
        optionValue="value"
        placeholder="Seleccionar aprobación de garantía..."
        styleClass="w-full"
        formControlName="warranty"
        [showClear]="true"
      />
    </div>
  </div>

  <div class="w-full flex gap-2">
    <div class="w-full">
      <label>REMITO DE PRODUCTO ENTRANTE</label>
      <input
        type="text"
        pInputText
        class="w-full"
        formControlName="startReference"
        placeholder="Ingresar número de remito de producto entrante"
      />
    </div>
    <div class="w-full">
      <label>REMITO DE PRODUCTO SALIENTE</label>
      <input
        type="text"
        pInputText
        class="w-full"
        formControlName="endReference"
        placeholder="Ingresar número de remito de producto saliente"
      />
    </div>
  </div>

  <div class="w-full flex gap-2">
    <div class="w-full">
      <label>NÚMERO DE COTIZACIÓN</label>
      <input
        type="text"
        pInputText
        class="w-full"
        formControlName="quoteNumber"
        placeholder="Ingresar número de cotización si corresponde"
      />
    </div>
    <div class="w-full">
      <label>NÚMERO DE ORDEN DE COMPRA</label>
      <input
        type="text"
        pInputText
        class="w-full"
        formControlName="orderNumber"
        placeholder="Ingresar número de orden de compra si corresponde"
      />
    </div>
  </div>

  <div class="w-full">
    <label>FAJA DE SEGURIDAD</label>
    <p-dropdown
      [options]="booleanDropdown"
      optionLabel="label"
      optionValue="value"
      placeholder="Seleccionar..."
      styleClass="w-full"
      formControlName="securityStrap"
      [showClear]="true"
      placeholder="Seleccionar aprobación de faja de seguridad..."
    />
  </div>

  <div class="w-full">
    <label>FALLA REPORTADA POR EL CLIENTE</label>
    <input
      type="text"
      pInputText
      class="w-full"
      formControlName="failure"
      placeholder="Ingresar falla reportada por el cliente"
    />
  </div>

  <div class="w-full">
    <label>FALLAS ENCONTRADAS</label>
    <p-multiSelect
      display="chip"
      [showToggleAll]="false"
      [options]="failureTypes"
      formControlName="failureTypes"
      optionLabel="name"
      optionValue="id"
      placeholder="Seleccionar..."
      styleClass="w-full"
      [showClear]="true"
      placeholder="Seleccionar fallas encontradas..."
    />
  </div>

  <div class="w-full">
    <label>OBSERVACIONES</label>
    <textarea
      pInputTextarea
      maxlength="500"
      class="w-full"
      [autoResize]="true"
      rows="6"
      formControlName="remarks"
      placeholder="Ingresar observaciones del servicio"
    ></textarea>
  </div>

  <div class="flex justify-content-between w-full">
    <div>
      <p-button
        *ngIf="showButtonClean"
        label="LIMPIAR FORMULARIO"
        styleClass="p-button-secondary p-button-text"
        (onClick)="cleanForm()"
      />
      <!--TODO: ELIMINAR EL BUTTON DE CANCELAR EL SERVICIO LO PODNREMOS DENTRO DEL SELECT -->
      <!-- <p-button
        *ngIf="showButtonCancel"
        label="CANCELAR SERVICIO"
        styleClass="p-button-danger p-button-text"
        (onClick)="cancelForm()"
      /> -->
      <p-button
        *ngIf="showButtonState"
        label="ACTUALIZAR ESTADO DEL SERVICIO"
        styleClass="p-button-success p-button-text"
        (onClick)="openHistoryForm()"
      />
    </div>
    <div class="flex gap-2">
      <p-button
        label="SALIR DEL FORMULARIO"
        styleClass="p-button-secondary p-button-text"
        (onClick)="exitForm()"
      />
      <p-button
        [label]="mainButtonLabel"
        [disabled]="supportForm.invalid"
        styleClass="p-button-info p-button-text"
        (onClick)="submitForm()"
      />
    </div>
  </div>
</form>

<!--TODO: Proximamente se agregará el componente de historial de estados -->
